package java_database_project;

import javax.swing.*;

import net.proteanit.sql.DbUtils;

import java.awt.*;
import java.sql.SQLException;

public class StatsWindow extends JFrame{

	private static final long serialVersionUID = 1L;
	private JLabel total_inventory;
	public static JTable troop_inventory_table;
	public StatsWindow(){
		this.setTitle("Statistics");
		this.setSize(new Dimension(400,400));
		this.setResizable(false);
		this.setDefaultCloseOperation(DISPOSE_ON_CLOSE);
		getContentPane().setLayout(null);
		
		JLayeredPane statsLayeredPane = new JLayeredPane();
		statsLayeredPane.setBounds(0, 0, 400, 400);
		getContentPane().add(statsLayeredPane);
		
		JPanel inventoryStats = new JPanel();
		inventoryStats.setBounds(0, 38, 400, 339);
		statsLayeredPane.add(inventoryStats);
		inventoryStats.setLayout(null);
		
		JLabel lblTotalInventory = new JLabel("Total Inventory:");
		lblTotalInventory.setHorizontalAlignment(SwingConstants.RIGHT);
		lblTotalInventory.setBounds(6, 6, 106, 16);
		inventoryStats.add(lblTotalInventory);
		
		total_inventory = new JLabel("total inventory");
		total_inventory.setHorizontalAlignment(SwingConstants.CENTER);
		total_inventory.setBounds(124, 6, 85, 16);
		inventoryStats.add(total_inventory);
		
		JLabel lblTotal = new JLabel("Total Inventory Per Troop");
		lblTotal.setHorizontalAlignment(SwingConstants.CENTER);
		lblTotal.setBounds(16, 34, 378, 16);
		inventoryStats.add(lblTotal);
		
		JScrollPane scrollPane = new JScrollPane();
		scrollPane.setBounds(6, 62, 388, 244);
		inventoryStats.add(scrollPane);
		
		troop_inventory_table = new JTable();
		scrollPane.setViewportView(troop_inventory_table);
		
		JButton btnInventory = new JButton("Inventory");
		btnInventory.setBounds(0, 6, 117, 29);
		statsLayeredPane.add(btnInventory);
		
		JButton btnShipment = new JButton("Shipment");
		btnShipment.setBounds(129, 6, 117, 29);
		statsLayeredPane.add(btnShipment);
		
		JButton btnProduct = new JButton("Product");
		btnProduct.setBounds(258, 6, 117, 29);
		statsLayeredPane.add(btnProduct);
		this.setVisible(true);
		
		loadData();
	}
	
	public void loadData(){
		Main.makeConnection();
		try {
			Main.preparedStatement = Main.connection.prepareStatement("SELECT SUM(QUANTITY) FROM INVENTORY");
			Main.result = Main.preparedStatement.executeQuery();
			while(Main.result.next()){
				total_inventory.setText(String.valueOf(Main.result.getLong(1)));
			}
			
			Main.preparedStatement = Main.connection.prepareStatement("SELECT TROOP.TROOP_ID, NAME, SUM(QUANTITY) FROM TROOP, INVENTORY A WHERE A.TROOP_ID IN (SELECT INVENTORY_ID, TROOP_ID FROM INVENTORY)");
			Main.result = Main.preparedStatement.executeQuery();
			StatsWindow.troop_inventory_table.setModel(DbUtils.resultSetToTableModel(Main.result));
			Main.closeConnection();
		} catch (SQLException e) {
			JOptionPane.showMessageDialog(null, e ,"Please make sure you have a connection to your database!",JOptionPane.WARNING_MESSAGE);
		}catch(Exception general){
			JOptionPane.showMessageDialog(null, general ,"Error!",JOptionPane.WARNING_MESSAGE);
		}
	}
}
